import{bL as R,bM as Q,u as A,r,x as d,j as t,L as F,bN as H,bO as O,bP as U,bQ as V,bR as $}from"./index-v68zVK4x.js";function B(){const{subdomain:b}=R(),[S]=Q(),{toast:l}=A(),[v,g]=r.useState(!0),[u,q]=r.useState(null),[E,P]=r.useState([]),[h,M]=r.useState([]),[m,_]=r.useState(null),[f,c]=r.useState([]),[k,p]=r.useState(!1),y=S.get("mesa"),[i,w]=r.useState(null);r.useEffect(()=>{I()},[b]);const I=async()=>{try{g(!0);const{data:e,error:a}=await d.from("companies").select("*").eq("subdomain",b).maybeSingle();if(a)throw a;if(!e){l({title:"Erro",description:"Estabelecimento não encontrado",variant:"destructive"});return}if(q(e),y){const{data:x}=await d.from("tables").select("id, table_number").eq("company_id",e.id).eq("table_number",y).maybeSingle();x&&w(x)}const{data:o}=await d.from("categories").select("*").eq("company_id",e.id).eq("on_off",!0).order("name");P(o||[]);const{data:s}=await d.from("products").select("*").eq("company_id",e.id).eq("on_off",!0).order("name");M(s||[])}catch(e){console.error("Error loading menu:",e),l({title:"Erro",description:"Erro ao carregar cardápio",variant:"destructive"})}finally{g(!1)}},D=(e,a=1,o)=>{c(s=>s.find(n=>n.product.id===e.id)?s.map(n=>n.product.id===e.id?{...n,quantity:n.quantity+a,observations:o}:n):[...s,{product:e,quantity:a,observations:o}]),l({title:"Produto adicionado",description:`${e.name} foi adicionado ao carrinho`})},T=(e,a)=>{if(a<=0){C(e);return}c(o=>o.map(s=>s.product.id===e?{...s,quantity:a}:s))},C=e=>{c(a=>a.filter(o=>o.product.id!==e))},j=()=>{c([])},N=()=>f.reduce((e,a)=>e+a.product.price*a.quantity,0),L=m?h.filter(e=>e.category_id===m):h;return v?t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:t.jsx(F,{className:"h-8 w-8 animate-spin text-primary"})}):u?t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx(H,{company:u}),i&&t.jsxs("div",{className:"bg-primary text-primary-foreground py-2 px-4 text-center",children:[t.jsxs("span",{className:"font-medium",children:["Mesa ",i.table_number]}),t.jsx("span",{className:"ml-2 text-sm opacity-80",children:"Pedido via QR Code"})]}),t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsx(O,{categories:E,selectedCategory:m,onSelectCategory:_}),t.jsx(U,{products:L,onAddToCart:D})]}),t.jsx("div",{className:"lg:col-span-1",children:t.jsx(V,{cart:f,onUpdateQuantity:T,onRemoveItem:C,onClearCart:j,onCheckout:()=>p(!0),total:N()})})]})}),k&&t.jsx($,{cart:f,total:N(),company:u,tableInfo:i,requireCustomerInfo:!!i,onClose:()=>p(!1),onSuccess:()=>{j(),p(!1)}})]}):t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Estabelecimento não encontrado"}),t.jsx("p",{className:"text-muted-foreground",children:"Verifique se o link está correto"})]})})}export{B as default};
