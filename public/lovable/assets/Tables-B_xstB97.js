import{J as Y,r as m,j as e,bZ as _,aj as T,B as x,T as S,P as L,I as Z,H as j,a2 as q,a3 as K,a4 as A,a5 as O,aa as P,C as Q,ar as b,f as X,aw as ee,bY as se,bU as ae}from"./index-v68zVK4x.js";import{c as ce,u as le,b as te,L as re,C as k,O as ie,U as ne}from"./OpenCheckDialog-uogF1vbw.js";import{C as de}from"./circle-alert-hkr6z4Ez.js";import"./useCompanyId-BPuD7pC1.js";function he(){const h=Y(),{tables:i,areas:v,tablesByArea:C,tablesWithoutArea:N,isLoading:I}=ce(),{settings:l}=le(),{setContext:M}=te(),[B,D]=m.useState("all"),[d,p]=m.useState("all"),[g,$]=m.useState(""),[z,w]=m.useState(!1),[U,E]=m.useState(null),t={minutes_1:(l==null?void 0:l.idle_alert_minutes_1)||15,minutes_2:(l==null?void 0:l.idle_alert_minutes_2)||30,minutes_3:(l==null?void 0:l.idle_alert_minutes_3)||45,color_1:(l==null?void 0:l.idle_color_1)||"#22c55e",color_2:(l==null?void 0:l.idle_color_2)||"#eab308",color_3:(l==null?void 0:l.idle_color_3)||"#f97316"},o=m.useMemo(()=>{let s=i;if(d!=="all"&&(s=s.filter(a=>{var n;const c=a.active_check&&a.status==="occupied",r=((n=a.active_check)==null?void 0:n.status)==="paid";switch(d){case"free":return!c||a.status==="available";case"occupied":return c&&!r;case"paid":return c&&r;default:return!0}})),g){const a=g.toLowerCase();s=s.filter(c=>{var y;const r=String(c.table_number).toLowerCase(),n=(c.name||"").toLowerCase(),W=(y=c.active_check)!=null&&y.check_number?String(c.active_check.check_number):"";return r.includes(a)||n.includes(a)||W.includes(a)})}return s},[i,d,g]),F=s=>{var a,c;s.status==="available"||!s.active_check?(E(s),w(!0)):(M({type:"table",table_id:s.id,table_number:parseInt(String(s.table_number))||0,check_id:(a=s.active_check)==null?void 0:a.id,check_number:(c=s.active_check)==null?void 0:c.check_number}),h("/pdv"))},G=s=>{h("/pdv")},R=s=>{var a;return!s.active_check||s.status==="available"?"text-green-500":((a=s.active_check)==null?void 0:a.status)==="paid"?"text-orange-500":"text-blue-500"},V=s=>s?s>=t.minutes_3?t.color_3:s>=t.minutes_2?t.color_2:s>=t.minutes_1?t.color_1:null:null,H=s=>{if(!s)return"";if(s<60)return`${s}min`;const a=Math.floor(s/60),c=s%60;return`${a}h${c>0?`${c}m`:""}`},J=s=>{var a;return!s.active_check||s.status==="available"?"Livre":((a=s.active_check)==null?void 0:a.status)==="paid"?"Paga":"Ocupada"},f=s=>{const a=R(s),c=s.idle_minutes?V(s.idle_minutes):null;return e.jsx(Q,{className:b("cursor-pointer hover:border-primary transition-all",s.status==="occupied"&&"border-blue-500/30"),onClick:()=>F(s),children:e.jsxs(X,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:b("w-5 h-5",a)}),e.jsx("span",{className:"font-bold text-lg",children:s.name||`Mesa ${s.table_number}`})]}),e.jsx(T,{variant:"outline",className:b("text-xs",a==="text-green-500"&&"border-green-500 text-green-600",a==="text-blue-500"&&"border-blue-500 text-blue-600",a==="text-orange-500"&&"border-orange-500 text-orange-600"),children:J(s)})]}),s.capacity&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mb-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.capacity," lugares"]})]}),s.status==="occupied"&&s.active_check&&e.jsxs("div",{className:"mt-3 pt-3 border-t space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Comanda #",s.active_check.check_number]})]}),s.idle_minutes&&s.idle_minutes>0&&e.jsxs("div",{className:"flex items-center gap-1",style:{color:c||void 0},children:[e.jsx(j,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:H(s.idle_minutes)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.check_items_count||0," itens"]}),e.jsx("span",{className:"font-bold text-primary",children:ae(s.check_total||0)})]})]})]})},s.id)},u=m.useMemo(()=>({all:i.length,free:i.filter(s=>!s.active_check||s.status==="available").length,occupied:i.filter(s=>s.active_check&&s.status==="occupied"&&s.active_check.status!=="paid").length,paid:i.filter(s=>{var a;return((a=s.active_check)==null?void 0:a.status)==="paid"}).length}),[i]);return I?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{className:"h-8 w-48"}),e.jsx(_,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:Array.from({length:12}).map((s,a)=>e.jsx(_,{className:"h-32 rounded-lg"},a))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-6 h-6"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Mesas"}),e.jsxs(T,{variant:"secondary",className:"ml-2",children:[u.occupied," / ",u.all," ocupadas"]})]}),e.jsxs(x,{onClick:()=>h("/settings?tab=tables"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Gerenciar Mesas"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Buscar mesa ou comanda...",value:g,onChange:s=>$(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:d==="all"?"default":"outline",size:"sm",onClick:()=>p("all"),children:["Todas (",u.all,")"]}),e.jsxs(x,{variant:d==="free"?"default":"outline",size:"sm",onClick:()=>p("free"),className:"gap-1",children:[e.jsx(k,{className:"w-3 h-3 text-green-500"}),"Livres (",u.free,")"]}),e.jsxs(x,{variant:d==="occupied"?"default":"outline",size:"sm",onClick:()=>p("occupied"),className:"gap-1",children:[e.jsx(k,{className:"w-3 h-3 text-blue-500"}),"Em uso (",u.occupied,")"]}),e.jsxs(x,{variant:d==="paid"?"default":"outline",size:"sm",onClick:()=>p("paid"),className:"gap-1",children:[e.jsx(k,{className:"w-3 h-3 text-orange-500"}),"Pagas (",u.paid,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground border rounded-lg p-2 bg-muted/30",children:[e.jsx("span",{className:"font-medium",children:"Tempo de ociosidade:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3",style:{color:t.color_1}}),e.jsxs("span",{children:["> ",t.minutes_1,"min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3",style:{color:t.color_2}}),e.jsxs("span",{children:["> ",t.minutes_2,"min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3",style:{color:t.color_3}}),e.jsxs("span",{children:["> ",t.minutes_3,"min"]})]})]}),i.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(de,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Nenhuma mesa cadastrada"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md",children:"Para começar a usar o sistema de mesas, cadastre as mesas do seu estabelecimento."}),e.jsxs(x,{onClick:()=>h("/settings?tab=tables"),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Cadastrar Mesas"]})]}),i.length>0&&o.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(L,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Nenhuma mesa encontrada"}),e.jsx("p",{className:"text-muted-foreground",children:"Tente ajustar os filtros ou termo de busca."})]}),o.length>0&&e.jsxs(q,{value:B,onValueChange:D,children:[e.jsxs(K,{children:[e.jsx(A,{value:"all",children:"Todas"}),v.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))]}),e.jsx(O,{value:"all",className:"mt-4",children:e.jsx(P,{className:"h-[calc(100vh-340px)]",children:e.jsxs("div",{className:"space-y-6",children:[C.map(({area:s,tables:a})=>{const c=a.filter(r=>o.some(n=>n.id===r.id));return c.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:s.name}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:c.map(f)})]},s.id)}),N.filter(s=>o.some(a=>a.id===s.id)).length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:"Sem Área"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:N.filter(s=>o.some(a=>a.id===s.id)).map(f)})]}),v.length===0&&N.length===0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:o.map(f)})]})})}),v.map(s=>{var c;const a=((c=C.find(r=>r.area.id===s.id))==null?void 0:c.tables.filter(r=>o.some(n=>n.id===r.id)))||[];return e.jsx(O,{value:s.id,className:"mt-4",children:e.jsx(P,{className:"h-[calc(100vh-340px)]",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:a.map(f)})})},s.id)})]}),e.jsx(ie,{open:z,onOpenChange:w,table:U,onSuccess:G})]})}export{he as default};
