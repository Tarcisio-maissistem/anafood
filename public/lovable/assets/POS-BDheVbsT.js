const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-v68zVK4x.js","assets/index-e3czBzwo.css"])))=>i.map(i=>d[i]);
import{c as cs,J as Ge,j as e,Y as rs,_ as ls,$ as is,a0 as os,W as pe,a1 as ds,aK as D,S as ms,m as xs,n as us,p as hs,q as Ce,a6 as G,aS as ps,aQ as ne,B as m,bT as Je,aH as oe,x as de,u as Ae,r as i,ab as js,ac as fs,ad as gs,ae as Ns,ar as W,bA as vs,bB as ys,bi as _s,bD as bs,bE as Ke,I as M,bU as j,aa as X,aj as Ne,X as ws,L as je,T as Ie,ah as Cs,a9 as Fe,bV as ks,P as fe,C as ce,f as re,b as Pe,d as De,bW as ge,b4 as We,bX as Xe,bY as Ee,bZ as He,H as ue,aw as Ss,A as Ts,aT as Ps,a2 as Ds,a3 as qs,a4 as ke,aP as As}from"./index-v68zVK4x.js";import{H as Is,u as Ye,B as Qe}from"./useCashRegister-D5UMR78Y.js";import{u as ve,L as he,a as ze,b as le,c as Fs,C as Se,O as Es,U as zs}from"./OpenCheckDialog-uogF1vbw.js";import{u as Me}from"./useCompanyId-BPuD7pC1.js";import{D as Ue}from"./dollar-sign-LxBQe3eU.js";import{C as Ms}from"./circle-check-DnVeMRDK.js";import{Q as Os}from"./qr-code-D6JTyGnX.js";import{C as Ze}from"./circle-alert-hkr6z4Ez.js";import{T as Ls}from"./truck-BReM8TfE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=cs("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);function Rs({open:p,onOpenChange:d}){const x=Ge(),{settings:u,updateSettings:y,isUpdating:N}=ve(),f=(r,v)=>{y({[r]:v})};return e.jsx(rs,{open:p,onOpenChange:d,children:e.jsxs(ls,{className:"w-[320px] sm:w-[400px]",children:[e.jsxs(is,{children:[e.jsxs(os,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Configurações do PDV"]}),e.jsx(ds,{children:"Personalize o comportamento do ponto de venda"})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(D,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Aba padrão ao abrir"]}),e.jsxs(ms,{value:(u==null?void 0:u.default_tab)||"counter",onValueChange:r=>f("default_tab",r),children:[e.jsx(xs,{children:e.jsx(us,{})}),e.jsxs(hs,{children:[e.jsx(Ce,{value:"counter",children:"Balcão"}),e.jsx(Ce,{value:"tables",children:"Mesas"}),e.jsx(Ce,{value:"delivery",children:"Entrega"})]})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4"}),"Impressão"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{htmlFor:"auto-print-send",className:"text-sm",children:"Imprimir ao enviar pedido"}),e.jsx(ne,{id:"auto-print-send",checked:(u==null?void 0:u.auto_print_on_send)||!1,onCheckedChange:r=>f("auto_print_on_send",r)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{htmlFor:"auto-print-close",className:"text-sm",children:"Imprimir ao fechar comanda"}),e.jsx(ne,{id:"auto-print-close",checked:(u==null?void 0:u.auto_print_on_close)||!1,onCheckedChange:r=>f("auto_print_on_close",r)})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Mesas"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{htmlFor:"require-waiter",className:"text-sm",children:"Exigir garçom ao abrir mesa"}),e.jsx(ne,{id:"require-waiter",checked:(u==null?void 0:u.require_waiter_on_table)||!1,onCheckedChange:r=>f("require_waiter_on_table",r)})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4"}),"Taxa de Serviço"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{htmlFor:"charge-service",className:"text-sm",children:"Cobrar taxa de serviço"}),e.jsx(ne,{id:"charge-service",checked:(u==null?void 0:u.charge_service_fee)||!1,onCheckedChange:r=>f("charge_service_fee",r)})]})]}),e.jsx(G,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Links Rápidos"}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{d(!1),x("/caixa")},children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Gerenciar Caixa"]}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{d(!1),x("/caixa/historico")},children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Histórico de Caixas"]}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{d(!1),x("/settings?tab=tables")},children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Gerenciar Mesas"]}),e.jsxs(m,{variant:"outline",className:"w-full justify-start",onClick:()=>{d(!1),x("/settings")},children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Outras Configurações"]})]})]})]})})}function Bs(){const{companyId:p}=Me(),{data:d=[],isLoading:x}=oe({queryKey:["payment-methods",p],queryFn:async()=>{if(!p)return[];const{data:u,error:y}=await de.from("payment_methods").select("id, name, type, is_active").eq("company_id",p).eq("is_active",!0).order("name");if(y)throw y;return u},enabled:!!p});return{paymentMethods:d,isLoading:x}}const Te=p=>{switch(p){case"cash":return Qe;case"pix":return Os;case"credit":case"debit":return Fe;default:return Qe}};function es({open:p,onOpenChange:d,total:x}){const{toast:u}=Ae(),{paymentMethods:y,isLoading:N}=Bs(),{createCheck:f,isCreating:r}=ze(),{activeRegister:v}=Ye(),{clearCart:S,context:T,service_percent:C,setService:k,setDiscount:Y,subtotal:O}=le(),[w,B]=i.useState([]),[l,_]=i.useState(null),[I,q]=i.useState(""),[H,V]=i.useState(""),[F,Q]=i.useState(!1),[$,A]=i.useState("percent"),[E,s]=i.useState(""),[t,o]=i.useState(!1),[a,b]=i.useState(T.type==="table"),[P,L]=i.useState(C||10),K=i.useRef(null),me=i.useRef(null),z=$==="percent"?O*(parseFloat(E)||0)/100:parseFloat(E.replace(",","."))||0,ie=t?O+z:O-z,J=a?ie*(P/100):0,se=Math.max(0,ie+J),xe=w.reduce((c,h)=>c+h.amount,0),U=Math.max(0,se-xe),n=U===0&&w.length>0;i.useEffect(()=>{l&&K.current&&setTimeout(()=>{var c;return(c=K.current)==null?void 0:c.focus()},100)},[l]),i.useEffect(()=>{p&&(Y(t?-z:z,$==="percent"&&parseFloat(E)||0),k(a?P:0))},[z,t,a,P,p]);const ae=c=>{_(c),q(U.toFixed(2).replace(".",",")),V("")},Z=c=>parseFloat(c.replace(/\./g,"").replace(",","."))||0,ee=()=>{if(!l)return;let c=Z(I);if(c<=0){u({title:"Valor inválido",description:"O valor do pagamento deve ser maior que zero.",variant:"destructive"});return}if(c>U&&(c=U),U<=0){u({title:"Conta já paga",description:"O valor total já foi coberto pelos pagamentos."});return}const h=l.type==="cash",R=Z(H),te=h&&R>0?R:c,_e=h&&R>c?R-c:0,be={id:`pay_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,payment_method_id:l.id,payment_method_name:l.name,payment_method_type:l.type,amount:c,received_amount:h?te:void 0,change_amount:h?_e:void 0};B([...w,be]),_(null),q(""),V("")},ye=c=>{B(w.filter(h=>h.id!==c))},ss=c=>{if(c.key==="Enter"&&(c.preventDefault(),l&&ee()),!l&&c.key>="1"&&c.key<="9"){const h=parseInt(c.key)-1;y[h]&&ae(y[h])}},as=async()=>{var c;if(n){Q(!0);try{const h=await f({}),{supabase:R}=await ks(async()=>{const{supabase:g}=await import("./index-v68zVK4x.js").then(we=>we.cc);return{supabase:g}},__vite__mapDeps([0,1])),{data:te}=await R.auth.getUser();if(!te.user)throw new Error("User not authenticated");const{cart:_e}=le.getState(),be=_e.map(g=>({check_id:h.id,company_id:h.company_id,created_by:te.user.id,product_id:g.product_id,product_name:g.product_name,product_sku:g.product_sku,unit_price:g.unit_price,quantity:g.quantity,extras:JSON.parse(JSON.stringify(g.extras)),extras_total:g.extras_total,notes:g.notes,promotion_id:g.promotion_id,discount_amount:g.discount_amount,total_price:g.total_price,status:"pending"})),{error:Re}=await R.from("check_items").insert(be);if(Re)throw Re;const{error:Be}=await R.from("checks").update({subtotal:ie,service_percent:a?P:0,service_amount:J,discount_amount:t?-z:z,total_amount:se}).eq("id",h.id);if(Be)throw Be;const ts=w.map(g=>({check_id:h.id,company_id:h.company_id,cash_register_id:v==null?void 0:v.id,payment_method_id:g.payment_method_id,payment_method_name:g.payment_method_name,payment_method_type:g.payment_method_type,amount:g.amount,received_amount:g.received_amount,change_amount:g.change_amount,processed_by:te.user.id,status:"completed"})),{error:Ve}=await R.from("check_payments").insert(ts);if(Ve)throw Ve;const ns=w.reduce((g,we)=>g+we.amount,0),{error:$e}=await R.from("checks").update({paid_amount:ns,status:"closed",closed_at:new Date().toISOString(),closed_by:(c=te.user)==null?void 0:c.id,paid_at:new Date().toISOString()}).eq("id",h.id);if($e)throw $e;S(),d(!1),B([]),s(""),o(!1),u({title:"Venda finalizada",description:`Comanda #${h.check_number} fechada com sucesso.`})}catch(h){console.error("Error finalizing payment:",h),u({title:"Erro ao finalizar",description:"Não foi possível processar o pagamento.",variant:"destructive"})}finally{Q(!1)}}},Oe=()=>{F||(B([]),_(null),q(""),V(""),s(""),o(!1),d(!1))},Le=(l==null?void 0:l.type)==="cash"?Z(H)-Z(I):0;return e.jsx(js,{open:p,onOpenChange:Oe,children:e.jsxs(fs,{className:"sm:max-w-lg",onKeyDown:ss,children:[e.jsx(gs,{children:e.jsx(Ns,{children:"Pagamento"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"text-sm font-medium",children:"Desconto / Acréscimo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:W("text-xs",!t&&"font-medium"),children:"Desconto"}),e.jsx(ne,{checked:t,onCheckedChange:o}),e.jsx("span",{className:W("text-xs",t&&"font-medium"),children:"Acréscimo"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(vs,{children:[e.jsx(ys,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"w-24",children:[$==="percent"?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-3 h-3 mr-1"})," %"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"})," R$"]}),e.jsx(_s,{className:"w-3 h-3 ml-1"})]})}),e.jsxs(bs,{children:[e.jsxs(Ke,{onClick:()=>A("percent"),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"})," Percentual"]}),e.jsxs(Ke,{onClick:()=>A("value"),children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"})," Valor Fixo"]})]})]}),e.jsx(M,{value:E,onChange:c=>s(c.target.value),placeholder:$==="percent"?"0":"0,00",className:"flex-1 text-right font-mono"})]}),z>0&&e.jsxs("div",{className:W("text-sm font-medium text-right",t?"text-orange-600":"text-green-600"),children:[t?"+":"-"," ",j(z)]})]}),T.type==="table"&&e.jsxs("div",{className:"rounded-lg border p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"text-sm font-medium",children:"Taxa de Serviço"}),e.jsx(ne,{checked:a,onCheckedChange:b})]}),a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{type:"number",value:P,onChange:c=>L(parseFloat(c.target.value)||0),className:"w-20 text-right font-mono",min:0,max:100}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"%"}),e.jsx("span",{className:"text-sm font-medium ml-auto",children:j(J)})]})]}),e.jsxs("div",{className:"rounded-lg bg-muted p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:j(O)})]}),z>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:t?"Acréscimo":"Desconto"}),e.jsxs("span",{className:W("font-medium",t?"text-orange-600":"text-green-600"),children:[t?"+":"-",j(z)]})]}),a&&J>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Serviço (",P,"%)"]}),e.jsx("span",{className:"font-medium",children:j(J)})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total da Conta"}),e.jsx("span",{className:"font-medium",children:j(se)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Já Pago"}),e.jsx("span",{className:"font-medium text-green-600",children:j(xe)})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Restante"}),e.jsx("span",{className:W(U===0?"text-green-600":"text-primary"),children:j(U)})]})]}),w.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Pagamentos Adicionados"}),e.jsx(X,{className:"max-h-32",children:e.jsx("div",{className:"space-y-2",children:w.map(c=>{const h=Te(c.payment_method_type);return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:c.payment_method_name}),c.change_amount&&c.change_amount>0&&e.jsxs(Ne,{variant:"outline",className:"text-xs",children:["Troco: ",j(c.change_amount)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:j(c.amount)}),e.jsx(m,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>ye(c.id),disabled:F,children:e.jsx(ws,{className:"w-3 h-3"})})]})]},c.id)})})})]}),U>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs(D,{className:"text-sm font-medium",children:["Adicionar Pagamento",e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(Atalhos: 1-9)"})]}),!l&&e.jsx("div",{className:"grid grid-cols-4 gap-2",children:N?e.jsx("div",{className:"col-span-4 flex justify-center py-4",children:e.jsx(je,{className:"w-5 h-5 animate-spin"})}):y.map((c,h)=>{const R=Te(c.type);return e.jsxs(m,{variant:"outline",className:"flex flex-col h-auto py-3 gap-1 relative",onClick:()=>ae(c),children:[e.jsx("span",{className:"absolute top-1 left-1 text-[10px] text-muted-foreground",children:h+1}),e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:c.name})]},c.id)})}),l&&e.jsxs("div",{className:"space-y-3 p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const c=Te(l.type);return e.jsx(c,{className:"w-4 h-4"})})(),e.jsx("span",{className:"font-medium",children:l.name})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>_(null),children:"Cancelar"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"amount",children:"Valor"}),e.jsx(M,{ref:K,id:"amount",value:I,onChange:c=>q(c.target.value),onKeyDown:c=>{var h;c.key==="Enter"&&(c.preventDefault(),l.type==="cash"?(h=me.current)==null||h.focus():ee())},placeholder:"0,00",className:"text-right text-lg font-mono"})]}),l.type==="cash"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"received",children:"Valor Recebido (opcional)"}),e.jsx(M,{ref:me,id:"received",value:H,onChange:c=>V(c.target.value),onKeyDown:c=>{c.key==="Enter"&&(c.preventDefault(),ee())},placeholder:"0,00",className:"text-right text-lg font-mono"})]}),Le>0&&e.jsxs("div",{className:"flex justify-between p-2 rounded bg-green-100 dark:bg-green-900/20",children:[e.jsx("span",{className:"text-sm font-medium",children:"Troco"}),e.jsx("span",{className:"font-bold text-green-600",children:j(Le)})]})]}),e.jsxs(m,{onClick:ee,className:"w-full",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Adicionar Pagamento (Enter)"]})]})]}),n&&e.jsxs("div",{className:"flex items-center justify-center gap-2 p-3 rounded-lg bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400",children:[e.jsx(Ms,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Pagamento completo!"})]})]}),e.jsxs(Cs,{className:"gap-2 sm:gap-0",children:[e.jsx(m,{variant:"outline",onClick:Oe,disabled:F,children:"Cancelar"}),e.jsx(m,{onClick:as,disabled:!n||F,children:F?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 mr-2 animate-spin"}),"Processando..."]}):"Finalizar Venda"})]})]})})}function Vs({onOrderSent:p}){const{companyId:d}=Me(),{toast:x}=Ae(),{createCheck:u,addItemsToCheckAsync:y}=ze(),{settings:N}=ve(),{cart:f,subtotal:r,service_amount:v,discount_amount:S,delivery_fee:T,total:C,context:k,addItem:Y,updateItem:O,removeItem:w,clearCart:B}=le(),[l,_]=i.useState(""),[I,q]=i.useState(null),[H,V]=i.useState(!1),[F,Q]=i.useState(!1),{data:$=[]}=oe({queryKey:["categories",d],queryFn:async()=>{if(!d)return[];const{data:a}=await de.from("categories").select("*").eq("company_id",d).eq("on_off",!0).order("display_order");return a||[]},enabled:!!d}),{data:A=[]}=oe({queryKey:["products",d,I,l],queryFn:async()=>{if(!d)return[];let a=de.from("products").select("*").eq("company_id",d).eq("on_off",!0).order("name");I&&(a=a.eq("category_id",I)),l&&(a=a.ilike("name",`%${l}%`));const{data:b}=await a;return b||[]},enabled:!!d}),E=a=>{Y({product_id:a.id,product_name:a.name,product_sku:a.internal_code,unit_price:a.price,quantity:1,extras:[],extras_total:0})},s=(a,b)=>{const P=f.find(K=>K.id===a);if(!P)return;const L=P.quantity+b;L<=0?w(a):O(a,{quantity:L})},t=async()=>{if(f.length!==0){Q(!0);try{const a=await u({});await y(a.id),x({title:"Comanda criada",description:`Comanda #${a.check_number} foi criada com sucesso.`}),N!=null&&N.auto_print_on_send&&console.log("Auto print enabled, should print..."),p==null||p()}catch(a){console.error("Error sending order:",a),x({title:"Erro ao criar comanda",description:"Não foi possível criar a comanda.",variant:"destructive"})}finally{Q(!1)}}},o=()=>{f.length!==0&&V(!0)};return e.jsxs("div",{className:"flex h-full gap-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Buscar produto por nome ou código...",value:l,onChange:a=>_(a.target.value),className:"pl-10"})]}),e.jsx(X,{className:"w-full whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2 pb-2",children:[e.jsx(m,{variant:I===null?"default":"outline",size:"sm",onClick:()=>q(null),children:"Todos"}),$.map(a=>e.jsx(m,{variant:I===a.id?"default":"outline",size:"sm",onClick:()=>q(a.id),children:a.name},a.id))]})}),e.jsx(X,{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:A.map(a=>e.jsx(ce,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>E(a),children:e.jsxs(re,{className:"p-3",children:[a.image_url&&e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-20 object-cover rounded mb-2"}),e.jsx("p",{className:"font-medium text-sm line-clamp-2",children:a.name}),e.jsx("p",{className:"text-primary font-bold mt-1",children:j(a.price)})]})},a.id))})})]}),e.jsxs(ce,{className:"w-[380px] flex flex-col",children:[e.jsxs(Pe,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-5 h-5"}),"Carrinho"]}),f.length>0&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:B,children:[e.jsx(We,{className:"w-4 h-4 mr-1"}),"Limpar"]})]}),e.jsxs(Ne,{variant:"outline",className:"w-fit",children:[k.type==="counter"&&"Balcão",k.type==="table"&&`Mesa ${k.table_number||""}`,k.type==="delivery"&&"Delivery",k.type==="pickup"&&"Retirada"]})]}),e.jsxs(re,{className:"flex-1 flex flex-col p-4 pt-0",children:[e.jsx(X,{className:"flex-1 -mx-4 px-4",children:f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-40 text-muted-foreground",children:[e.jsx(ge,{className:"w-10 h-10 mb-2"}),e.jsx("p",{children:"Carrinho vazio"})]}):e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.product_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j(a.unit_price)," × ",a.quantity]}),a.extras.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+ ",a.extras.map(b=>b.name).join(", ")]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(a.id,-1),children:e.jsx(Xe,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 text-center text-sm font-medium",children:a.quantity}),e.jsx(m,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>s(a.id,1),children:e.jsx(Ie,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"font-medium text-sm w-20 text-right",children:j(a.total_price)})]},a.id))})}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:j(r)})]}),v>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Serviço (10%)"}),e.jsx("span",{children:j(v)})]}),S>0&&e.jsxs("div",{className:"flex justify-between text-sm text-destructive",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-",j(S)]})]}),T>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa de entrega"}),e.jsx("span",{children:j(T)})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:j(C)})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",disabled:f.length===0||F,onClick:t,children:[F?e.jsx(je,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Enviar"]}),e.jsxs(m,{disabled:f.length===0,onClick:o,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Pagar"]})]})]})]}),e.jsx(es,{open:H,onOpenChange:V,total:C})]})}function $s({onTableSelected:p,onManageTables:d}){const{tables:x,areas:u,tablesByArea:y,tablesWithoutArea:N,isLoading:f}=Fs(),{settings:r}=ve(),{setContext:v}=le(),[S,T]=i.useState("all"),[C,k]=i.useState(""),[Y,O]=i.useState(!1),[w,B]=i.useState(null),l={minutes_1:(r==null?void 0:r.idle_alert_minutes_1)||15,minutes_2:(r==null?void 0:r.idle_alert_minutes_2)||30,minutes_3:(r==null?void 0:r.idle_alert_minutes_3)||45,color_1:(r==null?void 0:r.idle_color_1)||"#22c55e",color_2:(r==null?void 0:r.idle_color_2)||"#eab308",color_3:(r==null?void 0:r.idle_color_3)||"#f97316"},_=i.useMemo(()=>{let s=x;if(S!=="all"&&(s=s.filter(t=>{var b;const o=t.active_check&&t.status==="occupied",a=((b=t.active_check)==null?void 0:b.status)==="paid";switch(S){case"free":return!o||t.status==="available";case"occupied":return o&&!a;case"paid":return o&&a;default:return!0}})),C){const t=C.toLowerCase();s=s.filter(o=>{var L;const a=String(o.table_number).toLowerCase(),b=(o.name||"").toLowerCase(),P=(L=o.active_check)!=null&&L.check_number?String(o.active_check.check_number):"";return a.includes(t)||b.includes(t)||P.includes(t)})}return s},[x,S,C]),I=s=>{var t,o;s.status==="available"||!s.active_check?(B(s),O(!0)):(v({type:"table",table_id:s.id,table_number:parseInt(String(s.table_number))||0,check_id:(t=s.active_check)==null?void 0:t.id,check_number:(o=s.active_check)==null?void 0:o.check_number}),p(s))},q=s=>{w&&(v({type:"table",table_id:w.id,table_number:parseInt(String(w.table_number))||0,check_id:s}),p(w)),O(!1),B(null)},H=s=>{var t;return!s.active_check||s.status==="available"?"border-green-500/50 bg-green-500/5":((t=s.active_check)==null?void 0:t.status)==="paid"?"border-orange-500/50 bg-orange-500/5":"border-blue-500/50 bg-blue-500/5"},V=s=>{var t;return!s.active_check||s.status==="available"?"text-green-500":((t=s.active_check)==null?void 0:t.status)==="paid"?"text-orange-500":"text-blue-500"},F=s=>s?s>=l.minutes_3?l.color_3:s>=l.minutes_2?l.color_2:s>=l.minutes_1?l.color_1:null:null,Q=s=>{const t=s.minutes_idle??s.idle_minutes??0;if(!t||t<1)return"";if(t<60)return`${t}min`;const o=Math.floor(t/60),a=t%60;return a>0?`${o}h ${a}min`:`${o}h`},$=s=>{var o;return!((s.open_checks_count??0)>0||s.active_check)||s.status==="available"?"Livre":s.status==="paid"||((o=s.active_check)==null?void 0:o.status)==="paid"?"Paga":"Ocupada"},A=i.useMemo(()=>({all:x.length,free:x.filter(s=>!((s.open_checks_count??0)>0||s.active_check)||s.status==="available").length,occupied:x.filter(s=>{var t;return((s.open_checks_count??0)>0||s.active_check)&&s.status==="occupied"&&((t=s.active_check)==null?void 0:t.status)!=="paid"}).length,paid:x.filter(s=>{var t;return s.status==="paid"||((t=s.active_check)==null?void 0:t.status)==="paid"}).length}),[x]),E=s=>{var K;const t=V(s),o=Q(s),a=s.minutes_idle??s.idle_minutes?F(s.minutes_idle??s.idle_minutes??0):null,b=(s.open_checks_count??0)>0||s.active_check,P=s.current_total??s.check_total??0,L=s.open_checks_count??s.check_items_count??0;return e.jsx(ce,{className:W("cursor-pointer hover:shadow-md transition-all border-2",H(s)),onClick:()=>I(s),children:e.jsxs(re,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:W("w-5 h-5",t)}),e.jsx("span",{className:"font-bold",children:s.name||`Mesa ${s.table_number}`})]}),e.jsx(Ne,{variant:"outline",className:W("text-xs",t==="text-green-500"&&"border-green-500 text-green-600",t==="text-blue-500"&&"border-blue-500 text-blue-600",t==="text-orange-500"&&"border-orange-500 text-orange-600"),children:$(s)})]}),s.capacity&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-2",children:[e.jsx(Ss,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.capacity," lugares"]})]}),s.status==="occupied"&&b&&e.jsxs("div",{className:"mt-2 pt-2 border-t space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),e.jsxs("span",{children:["#",((K=s.active_check)==null?void 0:K.check_number)||L," comanda(s)"]})]}),o&&e.jsxs("div",{className:"flex items-center gap-1 animate-pulse",style:{color:a||void 0},children:[e.jsx(ue,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:o})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:s.waiter_name||"Sem garçom"}),e.jsx("span",{className:"font-bold text-primary text-sm",children:j(P)})]})]})]})},s.id)};return f?e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex gap-2",children:Array.from({length:4}).map((s,t)=>e.jsx(He,{className:"h-9 w-24"},t))}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:Array.from({length:16}).map((s,t)=>e.jsx(He,{className:"h-28 rounded-lg"},t))})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 border-b bg-muted/30",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Buscar mesa ou comanda...",value:C,onChange:s=>k(s.target.value),className:"pl-10 h-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(m,{variant:S==="all"?"default":"outline",size:"sm",onClick:()=>T("all"),children:["Todas (",A.all,")"]}),e.jsxs(m,{variant:S==="free"?"default":"outline",size:"sm",onClick:()=>T("free"),className:"gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-green-500"}),"Livres (",A.free,")"]}),e.jsxs(m,{variant:S==="occupied"?"default":"outline",size:"sm",onClick:()=>T("occupied"),className:"gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-blue-500"}),"Em uso (",A.occupied,")"]}),e.jsxs(m,{variant:S==="paid"?"default":"outline",size:"sm",onClick:()=>T("paid"),className:"gap-1",children:[e.jsx(Se,{className:"w-3 h-3 text-orange-500"}),"Pagas (",A.paid,")"]})]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:d,className:"ml-auto",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Gerenciar"]})]}),x.length===0&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-6",children:[e.jsx(Ze,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Nenhuma mesa cadastrada"}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md",children:"Para começar a usar o sistema de mesas, cadastre as mesas do seu estabelecimento."}),e.jsx(m,{onClick:d,children:"Cadastrar Mesas"})]}),x.length>0&&_.length===0&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center p-6",children:[e.jsx(fe,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Nenhuma mesa encontrada"}),e.jsx("p",{className:"text-muted-foreground",children:"Tente ajustar os filtros ou termo de busca."})]}),_.length>0&&e.jsx(X,{className:"flex-1",children:e.jsx("div",{className:"p-4",children:u.length>0?e.jsxs("div",{className:"space-y-6",children:[y.map(({area:s,tables:t})=>{const o=t.filter(a=>_.some(b=>b.id===a.id));return o.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-3",children:s.name}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:o.map(E)})]},s.id)}),N.filter(s=>_.some(t=>t.id===s.id)).length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Sem Área"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:N.filter(s=>_.some(t=>t.id===s.id)).map(E)})]})]}):e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:_.map(E)})})}),_.length>0&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground border-t p-3 bg-muted/30",children:[e.jsx("span",{className:"font-medium",children:"Ociosidade:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3",style:{color:l.color_1}}),e.jsxs("span",{children:[">",l.minutes_1,"min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3",style:{color:l.color_2}}),e.jsxs("span",{children:[">",l.minutes_2,"min"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3",style:{color:l.color_3}}),e.jsxs("span",{children:[">",l.minutes_3,"min"]})]})]}),e.jsx(Es,{open:Y,onOpenChange:O,table:w,onSuccess:q})]})}function Ks({onOrderSent:p}){const{companyId:d}=Me(),{toast:x}=Ae(),{createCheck:u,addItemsToCheckAsync:y}=ze(),{cart:N,subtotal:f,service_amount:r,discount_amount:v,delivery_fee:S,total:T,context:C,addItem:k,updateItem:Y,removeItem:O,clearCart:w,setContext:B,setDeliveryFee:l}=le(),[_,I]=i.useState(""),[q,H]=i.useState(null),[V,F]=i.useState(!1),[Q,$]=i.useState(!1),[A,E]=i.useState(C.customer_name||""),[s,t]=i.useState(C.customer_phone||""),[o,a]=i.useState(C.address||""),[b,P]=i.useState(C.address_number||""),[L,K]=i.useState(C.neighborhood||""),{data:me=[]}=oe({queryKey:["categories",d],queryFn:async()=>{if(!d)return[];const{data:n}=await de.from("categories").select("*").eq("company_id",d).eq("on_off",!0).order("display_order");return n||[]},enabled:!!d}),{data:z=[]}=oe({queryKey:["products",d,q,_],queryFn:async()=>{if(!d)return[];let n=de.from("products").select("*").eq("company_id",d).eq("on_off",!0).order("name");q&&(n=n.eq("category_id",q)),_&&(n=n.ilike("name",`%${_}%`));const{data:ae}=await n;return ae||[]},enabled:!!d}),ie=n=>{k({product_id:n.id,product_name:n.name,product_sku:n.internal_code,unit_price:n.price,quantity:1,extras:[],extras_total:0})},J=(n,ae)=>{const Z=N.find(ye=>ye.id===n);if(!Z)return;const ee=Z.quantity+ae;ee<=0?O(n):Y(n,{quantity:ee})},se=()=>{B({type:"delivery",customer_name:A,customer_phone:s,address:o,address_number:b,neighborhood:L})},xe=async()=>{if(N.length!==0){if(!A||!s||!o){x({title:"Dados incompletos",description:"Preencha nome, telefone e endereço do cliente.",variant:"destructive"});return}se(),$(!0);try{const n=await u({type:"delivery"});await y(n.id),x({title:"Pedido criado",description:`Pedido #${n.check_number} foi criado com sucesso.`}),E(""),t(""),a(""),P(""),K(""),p==null||p()}catch(n){console.error("Error sending order:",n),x({title:"Erro ao criar pedido",description:"Não foi possível criar o pedido.",variant:"destructive"})}finally{$(!1)}}},U=()=>{if(N.length!==0){if(!A||!s||!o){x({title:"Dados incompletos",description:"Preencha nome, telefone e endereço do cliente.",variant:"destructive"});return}se(),F(!0)}};return e.jsxs("div",{className:"flex h-full gap-4 p-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsxs(ce,{children:[e.jsx(Pe,{className:"py-3",children:e.jsxs(De,{className:"text-base flex items-center gap-2",children:[e.jsx(Ts,{className:"w-4 h-4"}),"Dados do Cliente"]})}),e.jsxs(re,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(D,{htmlFor:"name",className:"text-xs",children:"Nome *"}),e.jsx(M,{id:"name",placeholder:"Nome do cliente",value:A,onChange:n=>E(n.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(D,{htmlFor:"phone",className:"text-xs",children:"Telefone *"}),e.jsx(M,{id:"phone",placeholder:"(00) 00000-0000",value:s,onChange:n=>t(n.target.value),className:"h-9"})]})]}),e.jsx(G,{className:"my-3"}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ps,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Endereço de Entrega"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx(D,{htmlFor:"address",className:"text-xs",children:"Rua *"}),e.jsx(M,{id:"address",placeholder:"Nome da rua",value:o,onChange:n=>a(n.target.value),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(D,{htmlFor:"number",className:"text-xs",children:"Número"}),e.jsx(M,{id:"number",placeholder:"Nº",value:b,onChange:n=>P(n.target.value),className:"h-9"})]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx(D,{htmlFor:"neighborhood",className:"text-xs",children:"Bairro"}),e.jsx(M,{id:"neighborhood",placeholder:"Bairro",value:L,onChange:n=>K(n.target.value),className:"h-9"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(M,{placeholder:"Buscar produto...",value:_,onChange:n=>I(n.target.value),className:"pl-10"})]}),e.jsx(X,{className:"w-full whitespace-nowrap",children:e.jsxs("div",{className:"flex gap-2 pb-2",children:[e.jsx(m,{variant:q===null?"default":"outline",size:"sm",onClick:()=>H(null),children:"Todos"}),me.map(n=>e.jsx(m,{variant:q===n.id?"default":"outline",size:"sm",onClick:()=>H(n.id),children:n.name},n.id))]})}),e.jsx(X,{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:z.map(n=>e.jsx(ce,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>ie(n),children:e.jsxs(re,{className:"p-3",children:[n.image_url&&e.jsx("img",{src:n.image_url,alt:n.name,className:"w-full h-16 object-cover rounded mb-2"}),e.jsx("p",{className:"font-medium text-sm line-clamp-2",children:n.name}),e.jsx("p",{className:"text-primary font-bold mt-1 text-sm",children:j(n.price)})]})},n.id))})})]}),e.jsxs(ce,{className:"w-[350px] flex flex-col",children:[e.jsxs(Pe,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(De,{className:"flex items-center gap-2 text-base",children:[e.jsx(ge,{className:"w-5 h-5"}),"Carrinho"]}),N.length>0&&e.jsx(m,{variant:"ghost",size:"sm",onClick:w,children:e.jsx(We,{className:"w-4 h-4"})})]}),e.jsx(Ne,{variant:"secondary",className:"w-fit",children:"Entrega"})]}),e.jsxs(re,{className:"flex-1 flex flex-col p-4 pt-0",children:[e.jsx(X,{className:"flex-1 -mx-4 px-4",children:N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-32 text-muted-foreground",children:[e.jsx(ge,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm",children:"Carrinho vazio"})]}):e.jsx("div",{className:"space-y-2",children:N.map(n=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:n.product_name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j(n.unit_price)," × ",n.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>J(n.id,-1),children:e.jsx(Xe,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-6 text-center text-sm",children:n.quantity}),e.jsx(m,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>J(n.id,1),children:e.jsx(Ie,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"font-medium text-sm w-16 text-right",children:j(n.total_price)})]},n.id))})}),e.jsxs("div",{className:"mt-4 pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:j(f)})]}),v>0&&e.jsxs("div",{className:"flex justify-between text-sm text-destructive",children:[e.jsx("span",{children:"Desconto"}),e.jsxs("span",{children:["-",j(v)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa de entrega"}),e.jsx(M,{type:"number",step:"0.01",className:"h-7 w-20 text-right text-sm",value:S||"",onChange:n=>l(parseFloat(n.target.value)||0),placeholder:"0,00"})]}),e.jsx(G,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:j(T)})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxs(m,{variant:"outline",disabled:N.length===0||Q,onClick:xe,children:[Q?e.jsx(je,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Enviar"]}),e.jsxs(m,{disabled:N.length===0,onClick:U,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Pagar"]})]})]})]}),e.jsx(es,{open:V,onOpenChange:F,total:T})]})}function ea(){const p=Ge(),{isRegisterOpen:d}=Ye(),{settings:x}=ve(),{resetContext:u,context:y}=le(),[N,f]=i.useState(!1),[r,v]=i.useState("counter");i.useEffect(()=>{const k=x==null?void 0:x.default_tab;k&&["counter","tables","delivery"].includes(k)&&v(k)},[x]),i.useEffect(()=>{y.type==="table"&&y.table_id&&v("counter")},[y]);const S=()=>{v("counter")},T=()=>{y.type==="table"&&(u(),v("tables"))},C=()=>{p("/settings?tab=tables")};return d?e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b bg-background",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>f(!0),className:"shrink-0",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx(Ds,{value:r,onValueChange:k=>v(k),className:"flex-1",children:e.jsxs(qs,{className:"grid w-full max-w-md grid-cols-3",children:[e.jsxs(ke,{value:"counter",className:"gap-2",children:[e.jsx(As,{className:"w-4 h-4"}),"Balcão"]}),e.jsxs(ke,{value:"tables",className:"gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Mesas"]}),e.jsxs(ke,{value:"delivery",className:"gap-2",children:[e.jsx(Ls,{className:"w-4 h-4"}),"Entrega"]})]})})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[r==="counter"&&e.jsx("div",{className:"h-full p-4",children:e.jsx(Vs,{onOrderSent:T})}),r==="tables"&&e.jsx($s,{onTableSelected:S,onManageTables:C}),r==="delivery"&&e.jsx(Ks,{onOrderSent:T})]}),e.jsx(Rs,{open:N,onOpenChange:f})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[e.jsx(Ze,{className:"w-16 h-16 text-warning"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Caixa Fechado"}),e.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"É necessário abrir o caixa antes de iniciar as vendas."}),e.jsxs(m,{onClick:()=>p("/caixa"),children:[e.jsx(Je,{className:"w-4 h-4 mr-2"}),"Ir para Caixa"]})]})}export{ea as default};
