import{bG as _,u as D,r as o,x as f,j as t,L as I,bH as L,bI as T,bJ as H,bK as R,bL as A}from"./index-DebmrVr5.js";function J(){const{subdomain:p}=_(),{toast:i}=D(),[b,x]=o.useState(!0),[d,j]=o.useState(null),[S,v]=o.useState([]),[g,N]=o.useState([]),[l,E]=o.useState(null),[u,c]=o.useState([]),[k,m]=o.useState(!1);o.useEffect(()=>{q()},[p]);const q=async()=>{try{x(!0);const{data:e,error:a}=await f.from("companies").select("*").eq("subdomain",p).maybeSingle();if(a)throw a;if(!e){i({title:"Erro",description:"Estabelecimento não encontrado",variant:"destructive"});return}j(e);const{data:r}=await f.from("categories").select("*").eq("company_id",e.id).eq("on_off",!0).order("name");v(r||[]);const{data:s}=await f.from("products").select("*").eq("company_id",e.id).eq("on_off",!0).order("name");N(s||[])}catch(e){console.error("Error loading menu:",e),i({title:"Erro",description:"Erro ao carregar cardápio",variant:"destructive"})}finally{x(!1)}},w=(e,a=1,r)=>{c(s=>s.find(n=>n.product.id===e.id)?s.map(n=>n.product.id===e.id?{...n,quantity:n.quantity+a,observations:r}:n):[...s,{product:e,quantity:a,observations:r}]),i({title:"Produto adicionado",description:`${e.name} foi adicionado ao carrinho`})},M=(e,a)=>{if(a<=0){h(e);return}c(r=>r.map(s=>s.product.id===e?{...s,quantity:a}:s))},h=e=>{c(a=>a.filter(r=>r.product.id!==e))},C=()=>{c([])},y=()=>u.reduce((e,a)=>e+a.product.price*a.quantity,0),P=l?g.filter(e=>e.category_id===l):g;return b?t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:t.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})}):d?t.jsxs("div",{className:"min-h-screen bg-background",children:[t.jsx(L,{company:d}),t.jsx("div",{className:"container mx-auto px-4 py-6",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[t.jsx(T,{categories:S,selectedCategory:l,onSelectCategory:E}),t.jsx(H,{products:P,onAddToCart:w})]}),t.jsx("div",{className:"lg:col-span-1",children:t.jsx(R,{cart:u,onUpdateQuantity:M,onRemoveItem:h,onClearCart:C,onCheckout:()=>m(!0),total:y()})})]})}),k&&t.jsx(A,{cart:u,total:y(),company:d,onClose:()=>m(!1),onSuccess:()=>{C(),m(!1)}})]}):t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Estabelecimento não encontrado"}),t.jsx("p",{className:"text-muted-foreground",children:"Verifique se o link está correto"})]})})}export{J as default};

