import{u as H,aV as B,r as i,aH as R,aW as j,j as e,a9 as L,C as S,b as T,d as _,f as q,I as D,B as d,T as O,a_ as U,a$ as V,b0 as F,b1 as f,b2 as W,b3 as y,aQ as X,X as $,b4 as G,x as r}from"./index-v68zVK4x.js";import{A as J,a as Y,b as Z,c as ee,d as ae,e as se,f as te,g as ne}from"./alert-dialog-DWcOo5bl.js";import{S as ie}from"./save-zL82AGvd.js";import{P as re}from"./pen-BFxXknah.js";const me=()=>{const{toast:n}=H(),m=B(),[o,k]=i.useState(null),[l,v]=i.useState(""),[c,u]=i.useState(null),[h,C]=i.useState(""),[x,p]=i.useState(null);i.useEffect(()=>{async function a(){const{data:{user:s}}=await r.auth.getUser();if(s){const{data:t}=await r.from("profiles").select("company_id").eq("id",s.id).single();t!=null&&t.company_id&&k(t.company_id)}}a()},[]);const{data:N=[],isLoading:z}=R({queryKey:["payment-methods",o],queryFn:async()=>{if(!o)return[];const{data:a,error:s}=await r.from("payment_methods").select("*").eq("company_id",o).order("created_at",{ascending:!1});if(s)throw s;return a},enabled:!!o}),P=j({mutationFn:async a=>{const{error:s}=await r.from("payment_methods").insert({company_id:o,name:a});if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["payment-methods"]}),n({title:"Forma de pagamento adicionada",description:"A forma de pagamento foi adicionada com sucesso."}),v("")},onError:()=>{n({title:"Erro ao adicionar",description:"Não foi possível adicionar a forma de pagamento.",variant:"destructive"})}}),b=j({mutationFn:async({id:a,name:s,is_active:t})=>{const g={};s!==void 0&&(g.name=s),t!==void 0&&(g.is_active=t);const{error:E}=await r.from("payment_methods").update(g).eq("id",a);if(E)throw E},onSuccess:()=>{m.invalidateQueries({queryKey:["payment-methods"]}),n({title:"Forma de pagamento atualizada",description:"A forma de pagamento foi atualizada com sucesso."}),u(null)},onError:()=>{n({title:"Erro ao atualizar",description:"Não foi possível atualizar a forma de pagamento.",variant:"destructive"})}}),I=j({mutationFn:async a=>{const{error:s}=await r.from("payment_methods").delete().eq("id",a);if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["payment-methods"]}),n({title:"Forma de pagamento removida",description:"A forma de pagamento foi removida com sucesso."})},onError:()=>{n({title:"Erro ao remover",description:"Não foi possível remover a forma de pagamento.",variant:"destructive"})}}),w=()=>{l.trim()&&P.mutate(l.trim())},M=(a,s)=>{u(a),C(s)},A=()=>{c&&h.trim()&&b.mutate({id:c,name:h.trim()})},K=(a,s)=>{b.mutate({id:a,is_active:s})},Q=a=>{I.mutate(a),p(null)};return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(L,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Formas de Pagamento"})]}),e.jsxs(S,{children:[e.jsx(T,{children:e.jsx(_,{children:"Adicionar Forma de Pagamento"})}),e.jsx(q,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{placeholder:"Nome da forma de pagamento",value:l,onChange:a=>v(a.target.value),onKeyPress:a=>a.key==="Enter"&&w()}),e.jsxs(d,{onClick:w,disabled:!l.trim(),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Adicionar"]})]})})]}),e.jsxs(S,{children:[e.jsx(T,{children:e.jsx(_,{children:"Formas de Pagamento Cadastradas"})}),e.jsx(q,{children:z?e.jsx("p",{children:"Carregando..."}):N.length===0?e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma forma de pagamento cadastrada."}):e.jsxs(U,{children:[e.jsx(V,{children:e.jsxs(F,{children:[e.jsx(f,{children:"Nome"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Ações"})]})}),e.jsx(W,{children:N.map(a=>e.jsxs(F,{children:[e.jsx(y,{children:c===a.id?e.jsx(D,{value:h,onChange:s=>C(s.target.value),onKeyPress:s=>s.key==="Enter"&&A()}):a.name}),e.jsx(y,{children:e.jsx(X,{checked:a.is_active,onCheckedChange:s=>K(a.id,s)})}),e.jsx(y,{className:"text-right",children:c===a.id?e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{size:"sm",variant:"ghost",onClick:A,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>u(null),children:e.jsx($,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>M(a.id,a.name),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"ghost",onClick:()=>p(a.id),children:e.jsx(G,{className:"h-4 w-4"})})]})})]},a.id))})]})})]}),e.jsx(J,{open:!!x,onOpenChange:()=>p(null),children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Confirmar exclusão"}),e.jsx(ae,{children:"Tem certeza que deseja remover esta forma de pagamento?"})]}),e.jsxs(se,{children:[e.jsx(te,{children:"Cancelar"}),e.jsx(ne,{onClick:()=>x&&Q(x),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})})]})};export{me as default};
