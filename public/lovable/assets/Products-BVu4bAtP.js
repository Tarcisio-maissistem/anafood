import{r as x,u as B,aV as I,aH as y,x as o,aW as w,j as e,C as M,b as K,d as z,B as m,T as H,f as Q,P as R,I as j,a_ as A,a$ as O,b0 as b,b1 as i,b2 as V,b3 as c,aj as N,b4 as U,ab as W,ac as $,ad as G,ae as J,aK as d,S as X,m as Y,n as Z,p as ee,q as ae,b5 as se,aQ as re,ah as te}from"./index-v68zVK4x.js";import{S as ne}from"./square-pen-Bvg6CdWq.js";function ce(){const[h,S]=x.useState(""),[P,g]=x.useState(!1),[l,p]=x.useState(null),[t,n]=x.useState({name:"",price:0,description:"",category_id:"",image_url:"",on_off:!0}),{toast:u}=B(),f=I(),{data:s}=y({queryKey:["profile"],queryFn:async()=>{const{data:{user:a}}=await o.auth.getUser();if(!a)return null;const{data:r}=await o.from("profiles").select("company_id").eq("id",a.id).single();return r}}),{data:q=[]}=y({queryKey:["categories",s==null?void 0:s.company_id],queryFn:async()=>{if(!(s!=null&&s.company_id))return[];const{data:a,error:r}=await o.from("categories").select("*").eq("company_id",s.company_id).order("name");if(r)throw r;return a},enabled:!!(s!=null&&s.company_id)}),{data:F=[],isLoading:T}=y({queryKey:["products",s==null?void 0:s.company_id],queryFn:async()=>{if(!(s!=null&&s.company_id))return[];const{data:a,error:r}=await o.from("products").select("*, categories(name)").eq("company_id",s.company_id).order("name");if(r)throw r;return a},enabled:!!(s!=null&&s.company_id)}),D=w({mutationFn:async a=>{if(!(s!=null&&s.company_id))throw new Error("Company ID not found");if(l){const{error:r}=await o.from("products").update(a).eq("id",l.id);if(r)throw r}else{const{error:r}=await o.from("products").insert([{name:a.name||"",price:a.price||0,description:a.description,category_id:a.category_id,image_url:a.image_url,on_off:a.on_off,company_id:s.company_id}]);if(r)throw r}},onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),u({title:l?"Produto atualizado":"Produto cadastrado",description:"Operação realizada com sucesso."}),_()},onError:a=>{u({title:"Erro ao salvar produto",description:a.message,variant:"destructive"})}}),E=w({mutationFn:async a=>{const{error:r}=await o.from("products").delete().eq("id",a);if(r)throw r},onSuccess:()=>{f.invalidateQueries({queryKey:["products"]}),u({title:"Produto excluído",description:"Produto removido com sucesso."})},onError:a=>{u({title:"Erro ao excluir produto",description:a.message,variant:"destructive"})}}),v=a=>{a?(p(a),n(a)):(p(null),n({name:"",price:0,description:"",category_id:"",image_url:"",on_off:!0})),g(!0)},_=()=>{g(!1),p(null),n({name:"",price:0,description:"",category_id:"",image_url:"",on_off:!0})},L=()=>{if(!t.name||!t.price){u({title:"Campos obrigatórios",description:"Nome e preço são obrigatórios.",variant:"destructive"});return}D.mutate(t)},C=F.filter(a=>{var r;return a.name.toLowerCase().includes(h.toLowerCase())||((r=a.description)==null?void 0:r.toLowerCase().includes(h.toLowerCase()))}),k=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{className:"text-2xl font-bold",children:"Produtos"}),e.jsxs(m,{onClick:()=>v(),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Novo Produto"]})]})}),e.jsxs(Q,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(j,{placeholder:"Buscar produtos...",value:h,onChange:a=>S(a.target.value),className:"pl-10"})]})}),T?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):C.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:h?"Nenhum produto encontrado.":"Nenhum produto cadastrado."}):e.jsxs(A,{children:[e.jsx(O,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Categoria"}),e.jsx(i,{children:"Preço"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Descrição"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(V,{children:C.map(a=>{var r;return e.jsxs(b,{children:[e.jsx(c,{className:"font-medium",children:a.name}),e.jsx(c,{children:((r=a.categories)==null?void 0:r.name)&&e.jsx(N,{variant:"secondary",children:a.categories.name})}),e.jsx(c,{children:k(a.price)}),e.jsx(c,{children:e.jsx(N,{variant:a.on_off?"default":"secondary",children:a.on_off?"Ativo":"Inativo"})}),e.jsx(c,{className:"max-w-xs truncate",children:a.description}),e.jsxs(c,{className:"text-right",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>v(a),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>{confirm("Deseja realmente excluir este produto?")&&E.mutate(a.id)},children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})]})]},a.id)})})]})]})]}),e.jsx(W,{open:P,onOpenChange:g,children:e.jsxs($,{children:[e.jsx(G,{children:e.jsx(J,{children:l?"Editar Produto":"Novo Produto"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"name",children:"Nome *"}),e.jsx(j,{id:"name",value:t.name,onChange:a=>n({...t,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"category",children:"Categoria"}),e.jsxs(X,{value:t.category_id,onValueChange:a=>n({...t,category_id:a}),children:[e.jsx(Y,{children:e.jsx(Z,{placeholder:"Selecione uma categoria"})}),e.jsx(ee,{children:q.map(a=>e.jsx(ae,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"price",children:"Preço *"}),e.jsx(j,{id:"price",type:"number",step:"0.01",value:t.price,onChange:a=>n({...t,price:parseFloat(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Descrição"}),e.jsx(se,{id:"description",value:t.description,onChange:a=>n({...t,description:a.target.value}),rows:3})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"image_url",children:"URL da Imagem"}),e.jsx(j,{id:"image_url",value:t.image_url,onChange:a=>n({...t,image_url:a.target.value})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{htmlFor:"on_off",children:"Produto Ativo"}),e.jsx(re,{id:"on_off",checked:t.on_off,onCheckedChange:a=>n({...t,on_off:a})})]})]}),e.jsxs(te,{children:[e.jsx(m,{variant:"outline",onClick:_,children:"Cancelar"}),e.jsx(m,{onClick:L,children:l?"Atualizar":"Cadastrar"})]})]})})]})}export{ce as Products};
