import{r as x,u as k,aV as B,aH as w,x as n,aW as b,j as e,C as L,b as P,d as Q,B as u,T as z,f as H,P as I,I as j,a_ as K,a$ as R,b0 as N,b1 as o,b2 as O,b3 as c,aj as _,b4 as U,ab as V,ac as W,ad as $,ae as G,aK as h,b5 as J,aQ as X,ah as Y}from"./index-v68zVK4x.js";import{S as Z}from"./square-pen-Bvg6CdWq.js";function se(){const[m,E]=x.useState(""),[S,f]=x.useState(!1),[l,p]=x.useState(null),[i,t]=x.useState({name:"",price:0,category:"",description:"",on_off:!0}),{toast:d}=k(),y=B(),{data:r}=w({queryKey:["profile"],queryFn:async()=>{const{data:{user:a}}=await n.auth.getUser();if(!a)return null;const{data:s}=await n.from("profiles").select("company_id").eq("id",a.id).single();return s}}),{data:A=[],isLoading:F}=w({queryKey:["extras",r==null?void 0:r.company_id],queryFn:async()=>{if(!(r!=null&&r.company_id))return[];const{data:a,error:s}=await n.from("extras").select("*").eq("company_id",r.company_id).order("name");if(s)throw s;return a},enabled:!!(r!=null&&r.company_id)}),q=b({mutationFn:async a=>{if(!(r!=null&&r.company_id))throw new Error("Company ID not found");if(l){const{error:s}=await n.from("extras").update(a).eq("id",l.id);if(s)throw s}else{const{error:s}=await n.from("extras").insert([{name:a.name||"",price:a.price||0,category:a.category,description:a.description,on_off:a.on_off,company_id:r.company_id}]);if(s)throw s}},onSuccess:()=>{y.invalidateQueries({queryKey:["extras"]}),d({title:l?"Adicional atualizado":"Adicional cadastrado",description:"Operação realizada com sucesso."}),v()},onError:a=>{d({title:"Erro ao salvar adicional",description:a.message,variant:"destructive"})}}),T=b({mutationFn:async a=>{const{error:s}=await n.from("extras").delete().eq("id",a);if(s)throw s},onSuccess:()=>{y.invalidateQueries({queryKey:["extras"]}),d({title:"Adicional excluído",description:"Adicional removido com sucesso."})},onError:a=>{d({title:"Erro ao excluir adicional",description:a.message,variant:"destructive"})}}),g=a=>{a?(p(a),t(a)):(p(null),t({name:"",price:0,category:"",description:"",on_off:!0})),f(!0)},v=()=>{f(!1),p(null),t({name:"",price:0,category:"",description:"",on_off:!0})},D=()=>{if(!i.name){d({title:"Campo obrigatório",description:"Nome é obrigatório.",variant:"destructive"});return}q.mutate(i)},C=A.filter(a=>{var s;return a.name.toLowerCase().includes(m.toLowerCase())||((s=a.category)==null?void 0:s.toLowerCase().includes(m.toLowerCase()))}),M=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(L,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Q,{className:"text-2xl font-bold",children:"Adicionais"}),e.jsxs(u,{onClick:()=>g(),children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Novo Adicional"]})]})}),e.jsxs(H,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(j,{placeholder:"Buscar adicionais...",value:m,onChange:a=>E(a.target.value),className:"pl-10"})]})}),F?e.jsx("div",{className:"text-center py-8",children:"Carregando..."}):C.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:m?"Nenhum adicional encontrado.":"Nenhum adicional cadastrado."}):e.jsxs(K,{children:[e.jsx(R,{children:e.jsxs(N,{children:[e.jsx(o,{children:"Nome"}),e.jsx(o,{children:"Categoria"}),e.jsx(o,{children:"Preço"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Descrição"}),e.jsx(o,{className:"text-right",children:"Ações"})]})}),e.jsx(O,{children:C.map(a=>e.jsxs(N,{children:[e.jsx(c,{className:"font-medium",children:a.name}),e.jsx(c,{children:a.category&&e.jsx(_,{variant:"secondary",children:a.category})}),e.jsx(c,{children:M(a.price)}),e.jsx(c,{children:e.jsx(_,{variant:a.on_off?"default":"secondary",children:a.on_off?"Ativo":"Inativo"})}),e.jsx(c,{className:"max-w-xs truncate",children:a.description}),e.jsxs(c,{className:"text-right",children:[e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>g(a),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>{confirm("Deseja realmente excluir este adicional?")&&T.mutate(a.id)},children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})]})]},a.id))})]})]})]}),e.jsx(V,{open:S,onOpenChange:f,children:e.jsxs(W,{children:[e.jsx($,{children:e.jsx(G,{children:l?"Editar Adicional":"Novo Adicional"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"name",children:"Nome *"}),e.jsx(j,{id:"name",value:i.name,onChange:a=>t({...i,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"category",children:"Categoria"}),e.jsx(j,{id:"category",value:i.category,onChange:a=>t({...i,category:a.target.value}),placeholder:"Ex: Proteínas, Molhos, Queijos..."})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"price",children:"Preço"}),e.jsx(j,{id:"price",type:"number",step:"0.01",value:i.price,onChange:a=>t({...i,price:parseFloat(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",children:"Descrição"}),e.jsx(J,{id:"description",value:i.description,onChange:a=>t({...i,description:a.target.value}),rows:3})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{htmlFor:"on_off",children:"Adicional Ativo"}),e.jsx(X,{id:"on_off",checked:i.on_off,onCheckedChange:a=>t({...i,on_off:a})})]})]}),e.jsxs(Y,{children:[e.jsx(u,{variant:"outline",onClick:v,children:"Cancelar"}),e.jsx(u,{onClick:D,children:l?"Atualizar":"Cadastrar"})]})]})})]})}export{se as Extras};
