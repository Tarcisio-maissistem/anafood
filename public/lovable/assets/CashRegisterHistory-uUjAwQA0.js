import{ak as J,j as e,B as t,aS as S,aj as H,C as p,b as _,d as D,f as N,bT as K,A as P,aD as h,H as W,bU as o,a6 as M,aO as v,J as X,r as C,aH as k,Q as G,aK as T,I as q,S as Y,m as Z,n as ee,p as se,q as E,P as ae,a_ as te,a$ as ne,b0 as R,b1 as d,b2 as le,b3 as i,aa as ce,x as $,am as re}from"./index-v68zVK4x.js";import{u as de}from"./useCompanyId-BPuD7pC1.js";import{A as I}from"./arrow-left-CrBH0OTH.js";import{T as B}from"./triangle-alert-pjCGKzCy.js";import{C as L}from"./circle-check-DnVeMRDK.js";import{C as z}from"./calendar-xaMh49tc.js";import{d as ie,a as oe}from"./differenceInMinutes-DzoYFpRw.js";import{E as V}from"./eye-BTy0yhMb.js";import{s as me}from"./subDays-BxRSj4K1.js";function xe(a){const n=J(a);return n.setHours(23,59,59,999),n}function he({register:a,onBack:n,onPrint:r}){const y=a.opened_at?new Date(a.opened_at):new Date,m=a.closed_at?new Date(a.closed_at):new Date,g=ie(m,y),x=oe(m,y),O=x>=1?`${x}h ${g%60}min`:`${g} min`,l=a.difference||0,c=l!==0,j=w=>w>0?"text-success":w<0?"text-destructive":"text-muted-foreground";return e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6 max-w-3xl mx-auto print:p-0",children:[e.jsxs("div",{className:"flex items-center gap-4 print:hidden",children:[n&&e.jsx(t,{variant:"ghost",size:"icon",onClick:n,children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:"Resumo do Caixa"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fechamento realizado com sucesso"})]}),r&&e.jsxs(t,{variant:"outline",onClick:r,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Imprimir"]})]}),e.jsxs("div",{className:"hidden print:block text-center mb-6",children:[e.jsx("h1",{className:"text-xl font-bold",children:"FECHAMENTO DE CAIXA"}),e.jsx("p",{className:"text-sm",children:a.terminal_name||"Caixa #1"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{variant:c?"secondary":"default",className:`text-sm px-4 py-1 ${c?"":"bg-success text-success-foreground"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Fechado com diferença"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Fechado sem diferença"]})})}),e.jsxs(p,{children:[e.jsx(_,{className:"py-3",children:e.jsx(D,{className:"text-base",children:"Informações do Caixa"})}),e.jsx(N,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Terminal"}),e.jsx("p",{className:"font-medium",children:a.terminal_name||"Caixa #1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Operador"}),e.jsx("p",{className:"font-medium",children:a.operator_name||"Operador"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Abertura"}),e.jsx("p",{className:"font-medium",children:h(y,"dd/MM/yyyy HH:mm",{locale:v})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fechamento"}),e.jsx("p",{className:"font-medium",children:h(m,"dd/MM/yyyy HH:mm",{locale:v})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(W,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tempo Aberto"}),e.jsx("p",{className:"font-medium",children:O})]})]})]})})]}),e.jsxs(p,{children:[e.jsx(_,{className:"py-3",children:e.jsx(D,{className:"text-base",children:"Resumo Financeiro"})}),e.jsxs(N,{className:"pt-0 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Fundo Inicial"}),e.jsx("span",{className:"font-mono",children:o(a.opening_amount||0)})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor Esperado"}),e.jsx("span",{className:"font-mono font-bold",children:o(a.expected_amount||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor Contado"}),e.jsx("span",{className:"font-mono font-bold",children:o(a.closing_amount||0)})]}),e.jsx(M,{}),e.jsxs("div",{className:`flex justify-between items-center p-3 rounded-lg ${l>0?"bg-success/10":l<0?"bg-destructive/10":"bg-muted/50"}`,children:[e.jsx("span",{className:"font-medium",children:"Diferença"}),e.jsxs("span",{className:`font-mono font-bold text-lg ${j(l)}`,children:[l>=0?"+":"",o(l)]})]})]})]}),a.closing_notes&&e.jsxs(p,{children:[e.jsx(_,{className:"py-3",children:e.jsx(D,{className:"text-base",children:"Observações"})}),e.jsx(N,{className:"pt-0",children:e.jsx("p",{className:"text-sm",children:a.closing_notes})})]}),e.jsxs("div",{className:"flex gap-3 print:hidden",children:[n&&e.jsxs(t,{variant:"outline",className:"flex-1",onClick:n,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Voltar"]}),r&&e.jsxs(t,{className:"flex-1",onClick:r,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Imprimir"]})]})]})}function be(){const{companyId:a}=de(),n=X(),[r,y]=C.useState(h(me(new Date,30),"yyyy-MM-dd")),[m,g]=C.useState(h(new Date,"yyyy-MM-dd")),[x,O]=C.useState("all"),[l,c]=C.useState(null),{data:j,isLoading:w}=k({queryKey:["cash-register-history",a,r,m,x],queryFn:async()=>{if(!a)return[];let s=$.from("cash_registers").select("*").eq("company_id",a).eq("status","closed").gte("closed_at",re(new Date(r)).toISOString()).lte("closed_at",xe(new Date(m)).toISOString()).order("closed_at",{ascending:!1});x!=="all"&&(s=s.eq("operator_id",x));const{data:b,error:f}=await s;if(f)throw f;return b},enabled:!!a}),{data:F}=k({queryKey:["cash-register-operators",a],queryFn:async()=>{if(!a)return[];const{data:s,error:b}=await $.from("cash_registers").select("operator_id, operator_name").eq("company_id",a).eq("status","closed");if(b)throw b;const f=new Map;return s==null||s.forEach(u=>{u.operator_id&&!f.has(u.operator_id)&&f.set(u.operator_id,u.operator_name)}),Array.from(f.entries()).map(([u,U])=>({id:u,name:U}))},enabled:!!a}),A=s=>s>0?"text-success":s<0?"text-destructive":"text-muted-foreground",Q=()=>{window.print()};return l?e.jsx(he,{register:l,onBack:()=>c(null),onPrint:Q}):e.jsxs("div",{className:"p-4 md:p-6 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>n("/caixa"),children:e.jsx(I,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:"Histórico de Caixas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Consulte fechamentos anteriores"})]})]}),e.jsxs(p,{children:[e.jsx(_,{className:"py-3",children:e.jsxs(D,{className:"text-base flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Filtros"]})}),e.jsx(N,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"Data Inicial"}),e.jsx(q,{type:"date",value:r,onChange:s=>y(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"Data Final"}),e.jsx(q,{type:"date",value:m,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{children:"Operador"}),e.jsxs(Y,{value:x,onValueChange:O,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Todos"})}),e.jsxs(se,{children:[e.jsx(E,{value:"all",children:"Todos"}),F==null?void 0:F.map(s=>e.jsx(E,{value:s.id,children:s.name},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(t,{variant:"outline",className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Buscar"]})})]})})]}),e.jsx(p,{children:e.jsx(N,{className:"p-0",children:w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):j&&j.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(te,{children:[e.jsx(ne,{children:e.jsxs(R,{children:[e.jsx(d,{children:"Data"}),e.jsx(d,{children:"Operador"}),e.jsx(d,{children:"Terminal"}),e.jsx(d,{className:"text-right",children:"Esperado"}),e.jsx(d,{className:"text-right",children:"Contado"}),e.jsx(d,{className:"text-right",children:"Diferença"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"text-right",children:"Ações"})]})}),e.jsx(le,{children:j.map(s=>e.jsxs(R,{children:[e.jsx(i,{children:s.closed_at&&h(new Date(s.closed_at),"dd/MM/yyyy HH:mm",{locale:v})}),e.jsx(i,{children:s.operator_name||"Operador"}),e.jsx(i,{children:s.terminal_name||"Caixa #1"}),e.jsx(i,{className:"text-right font-mono",children:o(s.expected_amount||0)}),e.jsx(i,{className:"text-right font-mono",children:o(s.closing_amount||0)}),e.jsxs(i,{className:`text-right font-mono font-bold ${A(s.difference||0)}`,children:[(s.difference||0)>=0?"+":"",o(s.difference||0)]}),e.jsx(i,{children:e.jsx(H,{variant:(s.difference||0)===0?"default":"secondary",children:(s.difference||0)===0?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"OK"]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Diferença"]})})}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>c(s),children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>{c(s),setTimeout(()=>window.print(),100)},children:e.jsx(S,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden",children:e.jsx(ce,{className:"h-[calc(100vh-350px)]",children:e.jsx("div",{className:"p-4 space-y-3",children:j.map(s=>e.jsx(p,{className:"overflow-hidden",children:e.jsxs(N,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.closed_at&&h(new Date(s.closed_at),"dd/MM/yyyy",{locale:v})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.closed_at&&h(new Date(s.closed_at),"HH:mm",{locale:v})})]}),e.jsx(H,{variant:(s.difference||0)===0?"default":"secondary",children:(s.difference||0)===0?"OK":"Diferença"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Operador"}),e.jsx("p",{className:"font-medium",children:s.operator_name||"Operador"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-muted-foreground",children:"Diferença"}),e.jsxs("p",{className:`font-bold ${A(s.difference||0)}`,children:[(s.difference||0)>=0?"+":"",o(s.difference||0)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>c(s),children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Ver"]}),e.jsxs(t,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{c(s),setTimeout(()=>window.print(),100)},children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Imprimir"]})]})]})},s.id))})})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(K,{className:"w-12 h-12 mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhum caixa encontrado"}),e.jsx("p",{className:"text-sm",children:"Ajuste os filtros para buscar outros períodos"})]})})})]})}export{be as default};
