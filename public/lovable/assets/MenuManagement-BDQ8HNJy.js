import{c as B,r as h,u as _,j as e,aK as x,B as y,X as q,bK as I,U as M,x as u,aH as P,aW as F,C as w,b as C,d as E,e as S,f as z,I as b,b5 as O}from"./index-v68zVK4x.js";import{C as T}from"./CompanyLogoUpload-9w8QqJvB.js";import{E as $}from"./external-link-DOq83d_o.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=B("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function A({companyId:l,currentBannerUrl:d,companyName:k,onBannerUpdate:m}){const[f,p]=h.useState(!1),[v,n]=h.useState(d||null),{toast:o}=_();h.useEffect(()=>{n(d||null)},[d]);const s=async t=>{var N;const c=(N=t.target.files)==null?void 0:N[0];if(c){if(!c.type.startsWith("image/")){o({title:"Erro",description:"Por favor, selecione uma imagem válida",variant:"destructive"});return}if(c.size>5*1024*1024){o({title:"Erro",description:"A imagem deve ter no máximo 5MB",variant:"destructive"});return}p(!0);try{const g=URL.createObjectURL(c);n(g);const U=c.name.split(".").pop(),a=`${l}/banner.${U}`,{error:r}=await u.storage.from("company-logos").upload(a,c,{upsert:!0});if(r)throw r;const{data:{publicUrl:i}}=u.storage.from("company-logos").getPublicUrl(a),{error:j}=await u.from("companies").update({banner_url:i}).eq("id",l);if(j)throw j;m(i),o({title:"Sucesso",description:"Banner atualizado com sucesso"})}catch(g){console.error("Error uploading banner:",g),o({title:"Erro",description:"Erro ao fazer upload do banner",variant:"destructive"}),n(d||null)}finally{p(!1)}}},L=async()=>{try{p(!0);const{error:t}=await u.from("companies").update({banner_url:null}).eq("id",l);if(t)throw t;n(null),m(""),o({title:"Sucesso",description:"Banner removido com sucesso"})}catch(t){console.error("Error removing banner:",t),o({title:"Erro",description:"Erro ao remover banner",variant:"destructive"})}finally{p(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{children:"Banner do Cardápio"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative w-full h-48 rounded-lg border-2 border-dashed border-border flex items-center justify-center overflow-hidden bg-muted",children:v?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:v,alt:`Banner ${k}`,className:"w-full h-full object-cover"}),e.jsx(y,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8",onClick:L,disabled:f,children:e.jsx(q,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Nenhum banner enviado"})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",id:"banner-upload",accept:"image/*",onChange:s,disabled:f,className:"hidden"}),e.jsx(x,{htmlFor:"banner-upload",children:e.jsx(y,{type:"button",variant:"outline",disabled:f,asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),f?"Enviando...":"Enviar Banner"]})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recomendado: 1200x400px • Máximo: 5MB"})]})]})]})}function W(){const{toast:l}=_(),[d,k]=h.useState(null),[m,f]=h.useState(""),[p,v]=h.useState(""),[n,o]=h.useState({}),{data:s,isLoading:L}=P({queryKey:["company-menu"],queryFn:async()=>{const{data:{user:a}}=await u.auth.getUser();if(!a)return null;const{data:r}=await u.from("profiles").select("company_id").eq("id",a.id).single();if(!(r!=null&&r.company_id))return null;const{data:i}=await u.from("companies").select("*").eq("id",r.company_id).single();return i&&(k(i.id),f(i.subdomain||""),v(i.banner_url||""),o(i.schedule||{})),i}}),t=F({mutationFn:async a=>{if(!d)throw new Error("Company ID não encontrado");const{error:r}=await u.from("companies").update(a).eq("id",d);if(r)throw r},onSuccess:()=>{l({title:"Sucesso!",description:"Configurações do cardápio atualizadas."})},onError:()=>{l({title:"Erro",description:"Não foi possível atualizar as configurações.",variant:"destructive"})}}),c=()=>{t.mutate({banner_url:p,schedule:n})},N=()=>{const a=`https://${m}.anafood.vip`;navigator.clipboard.writeText(a),l({title:"Link copiado!",description:"O link do cardápio foi copiado para a área de transferência."})},g=()=>{window.open(`https://${m}.anafood.vip`,"_blank")};if(L)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})});const U=m?`https://${m}.anafood.vip`:"Aguardando subdomínio...";return e.jsxs("div",{className:"container mx-auto py-8 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Cardápio Digital"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie as configurações do seu cardápio online"})]})}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(E,{children:"Link do Cardápio"}),e.jsx(S,{children:"Compartilhe este link com seus clientes"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{value:U,readOnly:!0,className:"flex-1"}),e.jsx(y,{variant:"outline",size:"icon",onClick:N,children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(y,{variant:"outline",size:"icon",onClick:g,children:e.jsx($,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Os clientes poderão acessar seu cardápio e fazer pedidos através deste link"})]})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(E,{children:"Aparência do Cardápio"}),e.jsx(S,{children:"Personalize a aparência do seu cardápio digital"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Logo da Empresa"}),e.jsx(T,{companyId:d||"",currentLogoUrl:s==null?void 0:s.logo_url,companyName:(s==null?void 0:s.fantasy_name)||(s==null?void 0:s.name)||"",onLogoUpdate:a=>{l({title:"Logo atualizado",description:"O logo foi atualizado com sucesso!"})}}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Logo exibido no topo do cardápio"})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(A,{companyId:d||"",currentBannerUrl:p,companyName:(s==null?void 0:s.fantasy_name)||(s==null?void 0:s.name)||"",onBannerUpdate:a=>{v(a),l({title:"Banner atualizado",description:"O banner foi atualizado com sucesso!"})}})})]})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(E,{children:"Horários de Funcionamento"}),e.jsx(S,{children:"Configure os horários em que seu estabelecimento aceita pedidos"})]}),e.jsx(z,{children:e.jsx("div",{className:"space-y-4",children:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].map(a=>{var r,i;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{className:"w-32 capitalize",children:[a==="monday"&&"Segunda",a==="tuesday"&&"Terça",a==="wednesday"&&"Quarta",a==="thursday"&&"Quinta",a==="friday"&&"Sexta",a==="saturday"&&"Sábado",a==="sunday"&&"Domingo"]}),e.jsx(b,{type:"time",className:"w-32",value:((r=n[a])==null?void 0:r.open)||"08:00",onChange:j=>o({...n,[a]:{...n[a],open:j.target.value}})}),e.jsx("span",{children:"até"}),e.jsx(b,{type:"time",className:"w-32",value:((i=n[a])==null?void 0:i.close)||"22:00",onChange:j=>o({...n,[a]:{...n[a],close:j.target.value}})})]},a)})})})]}),e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(E,{children:"Informações Exibidas"}),e.jsx(S,{children:"Informações que aparecerão no seu cardápio"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Nome do Estabelecimento"}),e.jsx(b,{value:(s==null?void 0:s.fantasy_name)||(s==null?void 0:s.name)||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Telefone"}),e.jsx(b,{value:(s==null?void 0:s.phone)||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Descrição"}),e.jsx(O,{value:(s==null?void 0:s.description)||"",disabled:!0,rows:3}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Para alterar estas informações, acesse a página de Perfil da Empresa"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{onClick:c,disabled:t.isPending,size:"lg",children:t.isPending?"Salvando...":"Salvar Configurações"})})]})}export{W as default};
