import{c as A,r as u,u as Q,aV as B,aH as g,x as t,aW as f,j as e,C as H,b as I,d as L,aT as T,e as V,a2 as Z,a3 as O,a4 as k,B as x,T as U,f as W,a_ as G,a$ as J,b0 as N,b1 as c,b2 as X,b3 as l,aQ as z,b4 as Y,ab as ee,ac as ae,ad as se,ae as re,af as ie,aK as h,I as p,ah as te}from"./index-v68zVK4x.js";import{S as ne}from"./square-pen-Bvg6CdWq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=A("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);function le(){const[q,v]=u.useState(!1),[m,w]=u.useState(null),[_,C]=u.useState("zones"),[i,d]=u.useState({zone_name:"",delivery_fee:0,min_order_value:void 0,max_distance_km:void 0,is_active:!0}),{toast:n}=Q(),y=B(),{data:s}=g({queryKey:["profile"],queryFn:async()=>{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("User not found");const{data:r,error:o}=await t.from("profiles").select("company_id").eq("id",a.id).single();if(o)throw o;return r}}),{data:j}=g({queryKey:["company",s==null?void 0:s.company_id],queryFn:async()=>{if(!(s!=null&&s.company_id))return null;const{data:a,error:r}=await t.from("companies").select("delivery_mode").eq("id",s.company_id).single();if(r)throw r;return a},enabled:!!(s!=null&&s.company_id)});u.useState(()=>{j!=null&&j.delivery_mode&&C(j.delivery_mode)});const{data:E=[],isLoading:F}=g({queryKey:["delivery_fees",s==null?void 0:s.company_id],queryFn:async()=>{if(!(s!=null&&s.company_id))return[];console.log("Fetching delivery fees for company:",s.company_id);const{data:a,error:r}=await t.from("delivery_fees").select("*").eq("company_id",s.company_id).order("zone_name");if(r)throw console.error("Error fetching delivery fees:",r),r;return console.log("Delivery fees fetched:",a),a},enabled:!!(s!=null&&s.company_id)}),S=f({mutationFn:async a=>{if(!(s!=null&&s.company_id))throw new Error("Company ID not found");if(m){const{error:r}=await t.from("delivery_fees").update(a).eq("id",m.id);if(r)throw r}else{const r={...a,company_id:s.company_id,zone_name:a.zone_name||"",delivery_fee:a.delivery_fee||0},{error:o}=await t.from("delivery_fees").insert([r]);if(o)throw o}},onSuccess:()=>{y.invalidateQueries({queryKey:["delivery_fees"]}),n({title:"Sucesso",description:m?"Taxa atualizada com sucesso":"Taxa criada com sucesso"}),b()},onError:a=>{console.error("Error saving delivery fee:",a),n({title:"Erro",description:"Erro ao salvar taxa de entrega",variant:"destructive"})}}),M=f({mutationFn:async a=>{const{error:r}=await t.from("delivery_fees").delete().eq("id",a);if(r)throw r},onSuccess:()=>{y.invalidateQueries({queryKey:["delivery_fees"]}),n({title:"Sucesso",description:"Taxa excluída com sucesso"})},onError:a=>{console.error("Error deleting delivery fee:",a),n({title:"Erro",description:"Erro ao excluir taxa de entrega",variant:"destructive"})}}),D=f({mutationFn:async({id:a,is_active:r})=>{const{error:o}=await t.from("delivery_fees").update({is_active:r}).eq("id",a);if(o)throw o},onSuccess:()=>{y.invalidateQueries({queryKey:["delivery_fees"]}),n({title:"Sucesso",description:"Status atualizado com sucesso"})},onError:a=>{console.error("Error toggling active status:",a),n({title:"Erro",description:"Erro ao atualizar status",variant:"destructive"})}}),P=a=>{w(a),d({zone_name:a.zone_name,delivery_fee:a.delivery_fee,min_order_value:a.min_order_value,max_distance_km:a.max_distance_km,is_active:a.is_active}),v(!0)},R=async a=>{confirm("Tem certeza que deseja excluir esta taxa?")&&M.mutate(a)},b=()=>{v(!1),w(null),d({zone_name:"",delivery_fee:0,min_order_value:void 0,max_distance_km:void 0,is_active:!0})},K=a=>{a.preventDefault(),S.mutate(i)},$=async a=>{if(s!=null&&s.company_id)try{const{error:r}=await t.from("companies").update({delivery_mode:a}).eq("id",s.company_id);if(r)throw r;C(a),y.invalidateQueries({queryKey:["company"]}),n({title:"Sucesso",description:`Modo de cálculo alterado para ${a==="zones"?"Por Zonas":"Por Raio"}`})}catch(r){console.error("Error updating delivery mode:",r),n({title:"Erro",description:"Erro ao alterar modo de cálculo",variant:"destructive"})}};return e.jsxs("div",{className:"p-6",children:[e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(L,{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Taxas de Entrega"]}),e.jsx(V,{children:"Configure as taxas de entrega por zona ou raio de distância"}),e.jsx(Z,{value:_,onValueChange:a=>$(a),className:"mt-4",children:e.jsxs(O,{children:[e.jsxs(k,{value:"zones",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Por Zonas/Bairros"]}),e.jsxs(k,{value:"radius",className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Por Raio (km)"]})]})})]}),e.jsxs(x,{onClick:()=>v(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Nova Taxa"]})]})}),e.jsx(W,{children:F?e.jsx("div",{className:"text-center py-4",children:"Carregando..."}):E.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhuma taxa de entrega cadastrada"}):e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Zona"}),e.jsx(c,{children:"Taxa"}),e.jsx(c,{children:"Pedido Mínimo"}),e.jsx(c,{children:"Distância Máx."}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Ações"})]})}),e.jsx(X,{children:E.map(a=>e.jsxs(N,{children:[e.jsx(l,{className:"font-medium",children:a.zone_name}),e.jsxs(l,{children:["R$ ",a.delivery_fee.toFixed(2)]}),e.jsx(l,{children:a.min_order_value?`R$ ${a.min_order_value.toFixed(2)}`:"-"}),e.jsx(l,{children:a.max_distance_km?`${a.max_distance_km} km`:"-"}),e.jsx(l,{children:e.jsx(z,{checked:a.is_active,onCheckedChange:r=>D.mutate({id:a.id,is_active:r})})}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>P(a),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>R(a.id),children:e.jsx(Y,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})})]}),e.jsx(ee,{open:q,onOpenChange:v,children:e.jsxs(ae,{children:[e.jsxs(se,{children:[e.jsx(re,{children:m?"Editar Taxa de Entrega":"Nova Taxa de Entrega"}),e.jsx(ie,{children:"Preencha os dados da taxa de entrega"})]}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"zone_name",children:_==="zones"?"Nome da Zona/Bairro *":"Descrição do Raio *"}),e.jsx(p,{id:"zone_name",value:i.zone_name,onChange:a=>d({...i,zone_name:a.target.value}),placeholder:_==="zones"?"Ex: Centro, Bairro Sul":"Ex: Até 2km, Até 5km",required:!0})]}),_==="radius"&&e.jsxs("div",{children:[e.jsx(h,{htmlFor:"max_distance_km",children:"Distância Máxima (km) *"}),e.jsx(p,{id:"max_distance_km",type:"number",step:"0.1",value:i.max_distance_km||"",onChange:a=>d({...i,max_distance_km:a.target.value?parseFloat(a.target.value):void 0}),placeholder:"Ex: 2.0, 5.0",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"delivery_fee",children:"Taxa de Entrega (R$) *"}),e.jsx(p,{id:"delivery_fee",type:"number",step:"0.01",value:i.delivery_fee,onChange:a=>d({...i,delivery_fee:parseFloat(a.target.value)}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"min_order_value",children:"Valor Mínimo do Pedido (R$)"}),e.jsx(p,{id:"min_order_value",type:"number",step:"0.01",value:i.min_order_value||"",onChange:a=>d({...i,min_order_value:a.target.value?parseFloat(a.target.value):void 0}),placeholder:"Opcional"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{id:"is_active",checked:i.is_active,onCheckedChange:a=>d({...i,is_active:a})}),e.jsx(h,{htmlFor:"is_active",children:"Taxa ativa"})]})]}),e.jsxs(te,{className:"mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:b,children:"Cancelar"}),e.jsx(x,{type:"submit",children:m?"Salvar Alterações":"Criar Taxa"})]})]})]})})]})}export{le as DeliveryFees};
